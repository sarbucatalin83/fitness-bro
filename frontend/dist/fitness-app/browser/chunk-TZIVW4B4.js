import{C as i,Ma as o,Na as p,a as c,b as m,o as g,s as l,va as u}from"./chunk-BPJZSODR.js";var h=class n{supabaseService=l(p);programs=i([]);loading=i(!1);error=i(null);allPrograms=this.programs.asReadonly();isLoading=this.loading.asReadonly();loadError=this.error.asReadonly();activeProgram=u(()=>{let e=this.programs().find(r=>r.isActive);return e?m(c({},e),{currentWeek:2,completedWorkouts:4,totalWorkouts:6,nextWorkout:{dayId:e.days[0]?.id||"",dayName:`Day 1: ${e.days[0]?.name||"Workout"}`,exerciseCount:e.days[0]?.exercises?.length||0,estimatedDuration:e.days[0]?.estimatedDuration||45}}):null});libraryPrograms=u(()=>this.programs().filter(e=>!e.isActive));constructor(){this.supabaseService.client.auth.onAuthStateChange((e,r)=>{r?this.loadPrograms():this.programs.set([])}),this.supabaseService.isAuthenticated()&&this.loadPrograms()}getAuthHeaders(){return{Authorization:`Bearer ${this.supabaseService.getAccessToken()||o.supabaseAnonKey}`,"Content-Type":"application/json"}}async loadPrograms(){this.loading.set(!0),this.error.set(null);try{let e=await fetch(`${o.supabaseUrl}/functions/v1/programs`,{headers:this.getAuthHeaders()});if(!e.ok)throw new Error("Failed to load programs");let t=((await e.json()).data||[]).map(this.mapProgram);this.programs.set(t)}catch(e){console.error("Error loading programs:",e),this.error.set(e instanceof Error?e.message:"Failed to load programs")}finally{this.loading.set(!1)}}async getById(e){let r=this.programs().find(t=>t.id===e);if(r&&r.days.length>0)return r;try{let t=await fetch(`${o.supabaseUrl}/functions/v1/programs/${e}`,{headers:this.getAuthHeaders()});if(!t.ok)return;let s=await t.json();return this.mapProgram(s)}catch(t){console.error("Error fetching program:",t);return}}getDayById(e,r){return this.programs().find(s=>s.id===e)?.days.find(s=>s.id===r)}async createProgram(e){this.loading.set(!0);try{let r=await fetch(`${o.supabaseUrl}/functions/v1/programs`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({name:e.name,description:e.description,difficulty:e.difficulty,durationWeeks:e.durationWeeks,daysPerWeek:e.daysPerWeek,type:e.type,iconType:e.iconType,days:e.days?.map(a=>({dayNumber:a.dayNumber,name:a.name,muscleGroups:a.muscleGroups,estimatedDuration:a.estimatedDuration,exercises:a.exercises?.map(d=>({exerciseId:d.exerciseId,sets:d.sets,reps:d.reps}))}))})});if(!r.ok)throw new Error("Failed to create program");let t=await r.json(),s=this.mapProgram(t);return this.programs.update(a=>[...a,s]),s}catch(r){return console.error("Error creating program:",r),this.error.set(r instanceof Error?r.message:"Failed to create program"),null}finally{this.loading.set(!1)}}async setActiveProgram(e){try{if(!(await fetch(`${o.supabaseUrl}/functions/v1/programs/${e}/activate`,{method:"PUT",headers:this.getAuthHeaders()})).ok)throw new Error("Failed to activate program");return this.programs.update(t=>t.map(s=>m(c({},s),{isActive:s.id===e}))),!0}catch(r){return console.error("Error activating program:",r),!1}}async deleteProgram(e){try{if(!(await fetch(`${o.supabaseUrl}/functions/v1/programs/${e}`,{method:"DELETE",headers:this.getAuthHeaders()})).ok)throw new Error("Failed to delete program");return this.programs.update(t=>t.filter(s=>s.id!==e)),!0}catch(r){return console.error("Error deleting program:",r),!1}}mapProgram(e){return{id:e.id,name:e.name,description:e.description||"",difficulty:e.difficulty,durationWeeks:e.duration_weeks,daysPerWeek:e.days_per_week,type:e.type||"",isActive:e.is_active||!1,iconType:e.icon_type||"grid",days:(e.days||[]).map(r=>({id:r.id,dayNumber:r.day_number,name:r.name,muscleGroups:r.muscle_groups||"",estimatedDuration:r.estimated_duration||45,exercises:(r.exercises||[]).map(t=>({exerciseId:t.exercise_id||t.exercise?.id,exerciseName:t.exercise?.name||"",sets:t.sets,reps:t.reps}))}))}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};export{h as a};
